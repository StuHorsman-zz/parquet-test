USE cba;

set hive.exec.dynamic.partition=true;
set hive.exec.dynamic.partition.mode=nonstrict;
set hive.exec.max.dynamic.partitions=10000;
set hive.exec.max.dynamic.partitions.pernode=10000;
SET hive.exec.compress.output=true;
SET mapred.max.split.size=256000000;
SET mapred.output.compression.codec=org.apache.hadoop.io.compress.SnappyCodec;

INSERT OVERWRITE TABLE cba.payt_cmpn_temp_text
PARTITION(PARTITION_EVENT_CREATION_DATE)
SELECT
RECORD_TYPE AS RECORD_TYPE,
BLANK_FIELD AS BLANK_FIELD,
SPECIAL_CHAR AS SPECIAL_CHAR,
PAYT_CMPN_I AS PAYMENT_COMPONENT_ID         ,
EVNT_CRAT_D   AS EVENT_CREATION_DATE      ,
PAYT_EVNT_I AS PAYMENT_EVENT_ID        ,
CR_DR_F  AS CREDIT_DEBIT_FLAG          ,
CMPN_I  AS COMPONENT_ID           ,
CMPN_TYPE_CATG_I AS COMPONENT_TYPE_CAT_ID    ,
PDCT_TYPE  AS PRODUCT_TYPE         ,
PROS_SYST_CATG_I  AS PROCESSING_SYSTEM_CAT_ID   ,
REFN_TRCD  AS REFERENCE_TRANSACTION_CODE         ,
INPT_TRCD AS INPUT_TRANSACTION_CODE          ,
INPT_TRCD_FRMT_CATG_I AS INPUT_TRANS_CODE_FMT_CAT_ID ,
INPT_TRAN_SCOD  AS INPUT_TRANSACTION_SUBCODE    ,
PDCT_SYST_TRCD  AS PRODUCT_SYSTEM_TRANS_CODE    ,
PDCT_SYST_TRAN_SCOD AS PRODUCT_SYSTEM_TRANS_SUBCODE,
TRAN_A  AS TRANSACTION_AMOUNT            ,
CHQ_A   AS CHEQUE_AMOUNT ,
NUMB_OF_CHQ  AS NUM_CHEQUES       ,
SERN AS SERIAL_NUMBER            ,
ACCT_NUMB  AS ACCOUNT_NUMBER       ,
ACCT_NUMB_FRMT_CATG_I AS ACC_NUMBER_FORMAT_CAT_ID ,
INPT_X  AS INPUT_DESCRIPTION           ,
RESB_CNTR AS RESPONSIBILITY_CENTRE         ,
CLER_D AS CLEARING_DATE              ,
POST_D AS POSTING_DATE      ,
VALU_D AS VALUE_DATE               ,
ACTT  AS ACCOUNT_TITLE           ,
CUST_REF_NUMB AS CUSTOMER_REF_NUMBER       ,
BILL_REF_NUMB AS BILLER_REF_NUMBER      ,
OVRD_F  AS OVERRIDE_FLAG      ,
OVRD_USER_TYPE  AS OVERRIDE_USER_TYPE    ,
OVRD_USER_I    AS OVERRIDE_USER_ID      ,
TARG_SYST_REFN_NUMB AS TARGET_SYS_REF_NUMBER ,
REVS_F  AS REVERSAL_FLAG             ,
REVS_EVNT_RCPT_NUMB AS REV_EVENT_RECEIPT_NUMBER,
REVS_CMPN_I AS REVERSED_COMPONENT_ID        ,
CMPN_PROS_STUS_CATG_I AS COMPONENT_PROC_STATUS_CAT_ID,
INTN_ACCT_NUMB AS INTENTED_ACCOUNT_NUMBER     ,
INTN_ACCT_NUMB_FRMT_CATG_I AS INTN_ACCT_NUMB_FRMT_CATG_I ,
INTN_PROC_SYS_CATG_I AS INTENTED_PROC_SYS_CAT_ID,
IFW_EROR_C AS IFW_ERROR_CODE         ,
AGNT_NUMB AS AGENT_NUMBER          ,
APCA_I AS APCA_IDENTIFIER             ,
ACCT_ACCS_CARD AS ACCOUNT_ACCESS_CARD     ,
REMI AS REMITTER                ,
DRN  AS DRN               ,
BCHQ_RCPI_M AS BANK_CHQ_RECIPEINT_NAME         ,
PROS_BSB_NUMB AS PROCESSING_BSB      ,
TARG_SYST_MLTI_REFN_N AS TARGET_SYS_MULTI_REF_NUMBER ,
HOST_EROR_DETL  AS HOST_ERROR_DETAILS       ,
INTN_TRCD   AS INTENDED_TRANSACTION_CODE        ,
INTN_TRAN_SCOD AS INTENDED_SUB_TRANSACTION_CODE       ,
INTN_POST_D  AS INTENDED_POSTING_DATE         ,
INTN_VALU_D  AS INTENDED_VALUE_DATE       ,
INTN_CLER_D  AS INTENDED_CLEARING_DATE        ,
TRAC_ACCT    AS TRACE_ACCOUNT        ,
INTN_TRCD_FRMT_CATG_I   AS      INTENDED_TRANS_CODE_FMT_CAT_ID  ,
CNCY_A                  AS         CURRENCY_AMOUNT              ,
CNCY_C                  AS          CURRENCY_CODE               ,
CLER_REFN_NUMB              AS          CLEARING_REFERENCE_NUMBER   ,
CASH_A                  AS          CASH_AMOUNT                 ,
FEE_TOTL_GROS_A         AS          FEE_TOTAL_GROSS_AMOUNT      ,
FEE_TOTL_NET_A          AS          FEE_TOTAL_NET_AMOUNT        ,
XRTE                    AS          EXCHANGE_RATE               ,
REVS_TYPE_CATG_I        AS          REVERSAL_TYPE_CAT_ID        ,
BENF_BIC                AS          BENEFICIARY_BANK_ID         ,
BENF_BANK_N                 AS      BENEFICIARY_BANK_NAME       ,
REMI_ADRS_FRMT_TYPE_CATG_I  AS      REM_ADDR_FMT_TYPE_CAT_ID    ,
REMI_ADRS_L1               AS       REM_ADDR_LINE1              ,
REMI_ADRS_L2               AS       REM_ADDR_LINE2              ,
REMI_ADRS_L3                     REM_ADDR_LINE3                         ,
BENF_ADRS_FRMT_TYPE_CATG_I AS       BEN_ADDR_FMT_TYPE_CAT_ID    ,
BENF_ADRS_L1               AS       BEN_ADDR_LINE1              ,
BENF_ADRS_L2               AS       BEN_ADDR_LINE2              ,
BENF_ADRS_L3               AS       BEN_ADDR_LINE3              ,
BENF_BANK_ADRS_FRMT_TYPE_CAT_I AS   BEN_BANK_ADDR_FMT_TYPE_CAT_ID,
BENF_BANK_ADRS_L1              AS   BEN_BANK_ADDRESS_LINE1     ,
BENF_BANK_ADRS_L2              AS   BEN_BANK_ADDRESS_LINE2     ,
BENF_BANK_ADRS_L3              AS   BEN_BANK_ADDRESS_LINE3     ,
SEGM_GRUP_TYPE_CATG_I         AS   SEG_GROUP_TYPE_CAT_ID       ,
SEGM_GRUP                      AS   SEGMENTATION_GROUP         ,
SEGM_SUBG                      AS   SEGMENTATION_SUB_GROUP     ,
TRAC_ORIG_D                    AS   TRACE_ORIGIONAL_DATE       ,
TRAC_ORIG_APCA_I               AS   TRACE_ORIGIONAL_APCA_ID    ,
CHQ_IMGE_CAPT_D                AS   CHEQUE_IMAGE_CAPTURE_DATE  ,
BLANK_FIELD_2                  AS   BLANK_FIELD_2              ,
SUBSTR(EVNT_CRAT_D,1,8) as PARTITION_EVENT_CREATION_DATE
FROM cba.payt_cmpn;
